<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="/Sea/res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><nobr></nobr><h1 class='title'>Sea</h1><br/><p><h1>Initial</h1></p><p></p><p>As usual, we have two ports in the initial Nmap scan: port 80 and 22. And, we have a web app running on Apache and which is basically running on PHP.</p><p><img src="/Sea/images/1-1.png" alt="images/1-1.png" /></p><p>Also, upon checking out the web app, it can be seen that a Vhost instance is running on the server.</p><p><img src="/Sea/images/1-2.png" alt="images/1-2.png" /></p><p><img src="/Sea/images/1-3.png" alt="images/1-3.png" /></p><p></p><p>So the next step amounts to checking for any sort of SSRF in the website instance, along with enumerating the directories and other vhosts in the server using gobuster.</p><p><img src="/Sea/images/1-4.png" alt="images/1-4.png" /></p><p>So gobuster gave these some endpoints that showed 301 redirect but upon accessing them gave a 403 Forbidden error.</p><p><img src="/Sea/images/1-5.png" alt="images/1-5.png" /></p><p>At this point, I was stumped. I tried SSRF/File Upload type of attacks on Contact page..however even though I received the call back, I wasn&#39;t able to get anything concrete. So i went looking for some help, and came up with checking for files/directories under the 301 redirected ones. So I thought of runnning gobuster itself with more recursions or take it one by one. let&#39;s see.</p><p><img src="/Sea/images/1-6.png" alt="images/1-6.png" /></p><p><img src="/Sea/images/1-7.png" alt="images/1-7.png" /></p><p>So we get WonderCMS running v3.2.0 which has an RCE. <a href="https://gist.github.com/prodigiousMind/fc69a79629c4ba9ee88a7ad526043413">https://gist.github.com/prodigiousMind/fc69a79629c4ba9ee88a7ad526043413</a></p><p>Its funny though, as in I did not expect this. When I got the call back while enumerating contact.php, I thought that was the way to exploit this machine. However, that turned out to be a rabbit hole.</p><p><img src="/Sea/images/1-8.png" alt="images/1-8.png" /></p><p>So apparently the WonderCMS was running on this endpoint and not on ‘wondercms/loginURL’.  So this URL  must be properly added in the exploit. </p><p></p><p>The exploit baiscally is a XSS, that triggers the downloader and installs the reverse shell. Moreover, I tried executing the exploit as it is, but it did not work due to several reasons(for which I needed help). First, initially it didn&#39;t strike me that the HTB machines don&#39;t have internet connection in general, so when the exploited wanted to download a rev shell from Github it wouldn&#39;t have worked.  Second, was the LoginURL which I just didn&#39;t have any idea how to enumerate that(did not show up in Gobuster scans). Finally, this is more of a error from the creator of the box, which was that the exploit as it is won&#39;t work because the creator had  made some misconfigurations, so this necessitated the need for modifying the exploit zip name.</p><p><img src="/Sea/images/1-9.png" alt="images/1-9.png" /></p><p></p><p>And, to complete this exploit, the final thing was to paste/send the link in exploit in the ‘Contact.php’ page, which ultimately a user from box clicks and we get the shell back.I had to try this so many times before I was able to obtain the shell back.</p><p><img src="/Sea/images/1-10.png" alt="images/1-10.png" /></p><p></p><p><h1>Privilege Escalation</h1></p><p><img src="/Sea/images/1-11.png" alt="images/1-11.png" /></p><p>So we have a brcrypt hash, which my guess, since it has been included in a js file, has some escape string characters. My suspicion of this is due to the fact that hashcat was throwing an error and not exactly cracking the password.</p><p><img src="/Sea/images/1-12.png" alt="images/1-12.png" /></p><p><img src="/Sea/images/1-13.png" alt="images/1-13.png" /></p><p></p><p>So we get the password. Also, the box has two normal users:  amay and geo. So, now we try to SSH into anyone of these users using the above pwd.</p><p><img src="/Sea/images/1-14.png" alt="images/1-14.png" /></p><p>And, we get lucky!!! Now to get to root. First, I ran linpeas and observed that few internal porta were running on 8080. However, before that, first I checked if I had any sudo privs and the custom cron job that was running for the web app. This lead to nothing. So back to the internal port 8080!!</p><p><img src="/Sea/images/1-15.png" alt="images/1-15.png" /></p><p>So I forwarded that port using SSH and accessed the appln. It asked for user creds to which I provided Amay&#39;s and Voila!!</p><p><img src="/Sea/images/1-16.png" alt="images/1-16.png" /></p><p>So the application as itself didn&#39;t give anything. So I forwarded the requests to Burp (for this, I took a little help as I was stuck).</p><p><img src="/Sea/images/1-17.png" alt="images/1-17.png" /></p><p><img src="/Sea/images/1-18.png" alt="images/1-18.png" /></p><p>So the analyze function in the application is basically checking the file passed for any suspicious commands. So the idea is to modify the log_file parameter to a file we want to access. But there is a catch. This function as it is doesn&#39;t print the file contents to the application. However,  what if the file we want does contain some bad parameters or commands?</p><p><img src="/Sea/images/1-19.png" alt="images/1-19.png" /></p><p><img src="/Sea/images/1-20.png" alt="images/1-20.png" /></p><p>And we got the root flag. Moreover, we were able to execute commands as well. So I think, this way we can proceed to obtain root. Honestly, i tried multiple things here..Bash rev shell, Nc, Root SSH, /shadow and /passwd bruteforce. But everything seemed to either not work or take too much time, so I am going to refrain. So that&#39;s the box!!</p></div>
</body>
</html>
