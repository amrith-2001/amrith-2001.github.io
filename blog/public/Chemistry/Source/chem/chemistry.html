<!DOCTYPE html> <html><head>
		<title>Chemistry</title>
		<base href="../">
		<meta id="root-path" root-path="../">
		<style>
			
			.page-title {
				text-align: center;
				width: 100%;
				margin-bottom: 2em;
			}
			
			/* Hide unnecessary logos */
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview-header {
				display: none;
			}

			/* Hide unnecessary elements */
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview-header,
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview-header-title,
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview-header-links,
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview-header-links .markdown-preview-header-link,
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview-header-links .markdown-preview-header-link:hover,
			.markdown-preview-view .markdown-preview-sizer .markdown-preview-sizer-inner .markdown-preview
			
			/* Center main content */
			.markdown-preview-view {
				display: flex;
				flex-direction: column;
				align-items: center;
				width: 100%;
			}
			</style>
			
		<script>
			document.addEventListener('DOMContentLoaded', function() {
				// Check if scripts are loaded
				waitLoadScripts(['webpage', 'graph-wasm', 'graph-render-worker', 'tinycolor', 'pixi', 'minisearch', 'graph-data'], function() {
					// Remove hide class from container after scripts load
					document.querySelector('.document-container').classList.remove('hide');
				});
			});
			</script>
			
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes, minimum-scale=1.0, maximum-scale=5.0">
		<meta charset="UTF-8">
		<meta name="description" content="HTB - Chemistry">
		<meta property="og:title" content="Chemistry">
		<meta property="og:description" content="HTB - Chemistry">
		<meta property="og:type" content="website">
<style>
.document-container {
		opacity: 1 !important;
		display: block !important;
}
.hide {
		opacity: 1 !important;
		display: block !important;
}
</style>
		<meta property="og:url" content="/Chemistry/Source/chem/chemistry.html">
		<meta property="og:image" content="/Chemistry/Source/chem/pasted-image-20241101122329.png">
		<meta property="og:site_name" content="HTB">
		<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/Chemistry/lib/rss.xml"><script async="" id="webpage-script" src="/Chemistry/lib/scripts/webpage.js" onload="this.onload=null;this.setAttribute('loaded', 'true')"></script><script type = "module"
		async = ""
		id = "graph-view-script"
		src =
			"/Chemistry/lib/scripts/graph-view.js" >
			</script><script async="" id="graph-wasm-script" src="/Chemistry /
			lib / scripts / graph - wasm
			.js " onload="this.onload = null;this.setAttribute('loaded', 'true')"></script><script async="
		" id="
		graph - render - worker -
			script " src=" / Chemistry / lib /
			scripts / graph - render - worker
			.js " onload="
		this.onload = null;
		this.setAttribute('loaded', 'true')
		"></script><script async="
		" id="
		tinycolor - script " src=" / Chemistry /
			lib / scripts / tinycolor
			.js " onload="
		this.onload = null;
		this.setAttribute('loaded', 'true')
		"></script><script async="
		" id="
		pixi - script " src="
		https
		: //cdnjs.cloudflare.com/ajax/libs/pixi.js/7.4.0/pixi.min.js" onload="this.onload=null;this.setAttribute('loaded', 'true')"></script><script async="" id="minisearch-script" src="https://cdn.jsdelivr.net/npm/minisearch@6.3.0/dist/umd/index.min.js" onload="this.onload=null;this.setAttribute('loaded', 'true')"></script><link rel="icon" href="/Chemistry/lib/media/favicon.png"><script async="" id="graph-data-script" src="/Chemistry/lib/scripts/graph-data.js" onload="this.onload=null;this.setAttribute('loaded', 'true')"></script><style>
		body {
			--line-width: 40em;
			--line-width-adaptive: 40em;
			--file-line-width: 40em;
			--sidebar-width: min(20em, 80vw);
			--collapse-arrow-size: 11px;
			--tree-horizontal-spacing: 0.6em;
			--tree-vertical-spacing: 0.6em;
			--sidebar-margin: 12px;
		  }
		  
		  
		  .topbar-content {
			overflow: hidden;
			overflow: clip;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			transition: inherit;
		  }
		  body {
			transition: background-color var(--color-fade-speed) ease-in-out;
		  }
		  .webpage-container {
			display: flex;
			flex-direction: row;
			height: 100%;
			width: 100%;
			align-items: stretch;
			justify-content: center;
		  }
		  .document-container {
			opacity: 1;
			flex-basis: 100%;
			max-width: 100%;
			width: 100%;
			height: 100%;
			display: flex;
			flex-direction: column;
			align-items: center;
			transition: opacity 0.2s ease-in-out;
			contain: inline-size;
		  }
		  .hide {
			opacity: 0;
			transition: opacity 0.2s ease-in-out;
		  }
		  .document-container > .markdown-preview-view {
			margin: var(--sidebar-margin);
			margin-bottom: 0;
			width: 100%;
			width: -webkit-fill-available;
			width: -moz-available;
			width: fill-available;
			background-color: var(--background-primary);
			transition: background-color var(--color-fade-speed) ease-in-out;
			border-top-right-radius: var(--window-radius, var(--radius-m));
			border-top-left-radius: var(--window-radius, var(--radius-m));
			overflow-x: hidden !important;
			overflow-y: auto !important;
			display: flex !important;
			flex-direction: column !important;
			align-items: center !important;
			contain: inline-size;
		  }
		  .document-container > .markdown-preview-view > .markdown-preview-sizer {
			padding-bottom: 80vh !important;
			width: 100% !important;
			max-width: var(--line-width) !important;
			flex-basis: var(--line-width) !important;
			transition: background-color var(--color-fade-speed) ease-in-out;
			contain: inline-size;
		  }
		  .markdown-rendered img:not([width]),
		  .view-content img:not([width]) {
			max-width: 100%;
			outline: 0;
		  }
		  .document-container > .view-content.embed {
			display: flex;
			padding: 1em;
			height: 100%;
			width: 100%;
			align-items: center;
			justify-content: center;
		  }
		  .document-container > .view-content.embed > * {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
		  }
		  :has(> :is(.math, table)) {
			overflow-x: auto !important;
		  }
		  .document-container > .view-content {
			overflow-x: auto;
			contain: content;
			padding: 0;
			margin: 0;
			height: 100%;
		  }
		  .scroll-highlight {
			position: absolute;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 1000;
			background-color: hsla(var(--color-accent-hsl), 0.25);
			opacity: 0;
			padding: 1em;
			inset: 50%;
			translate: -50% -50%;
			border-radius: var(--radius-s);
		  }
		  </style>
		  <script defer="">async function loadIncludes(){if("file:"!=location.protocol){let e=document.querySelectorAll("include");for(let t=0;t<e.length;t++){let o=e[t],l=o.getAttribute("src");try{const e=await fetch(l);if(!e.ok){console.log("Could not include file: "+l),o?.remove();continue}let t=await e.text(),n=document.createRange().createContextualFragment(t),i=Array.from(n.children);for(let e of i)e.classList.add("hide"),e.style.transition="opacity 0.5s ease-in-out",setTimeout((()=>{e.classList.remove("hide")}),10);o.before(n),o.remove(),console.log("Included file: "+l)}catch(e){o?.remove(),console.log("Could not include file: "+l,e);continue}}}else{if(document.querySelectorAll("include").length>0){var e=document.createElement("div");e.id="error",e.textContent="Web server exports must be hosted on an http / web server to be viewed correctly.",e.style.position="fixed",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%)",e.style.fontSize="1.5em",e.style.fontWeight="bold",e.style.textAlign="center",document.body.appendChild(e),document.querySelector(".document-container")?.classList.remove("hide")}}}document.addEventListener("DOMContentLoaded",(()=>{loadIncludes()}));let isFileProtocol="file:"==location.protocol;function waitLoadScripts(e,t){let o=e.map((e=>document.getElementById(e+"-script"))),l=0;!function e(){let n=o[l];l++,n&&"true"!=n.getAttribute("loaded")||l<o.length&&e(),l<o.length?n.addEventListener("load",e):t()}()}</script><link rel="stylesheet" href="/Chemistry/lib/styles/obsidian.css"><link rel="preload" href="/Chemistry/lib/styles/global-variable-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/Chemistry/lib/styles/global-variable-styles.css"></noscript><link rel="preload" href="/Chemistry/lib/styles/main-styles.css" as="style" onload="this.onload=null;this.rel='stylesheet'"><noscript><link rel="stylesheet" href="/Chemistry/lib/styles/main-styles.css"></noscript></head><body class="publish css-settings-manager theme-dark show-inline-title show-ribbon"><script defer="">let theme=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");"dark"==theme?(document.body.classList.add("theme-dark"),document.body.classList.remove("theme-light")):(document.body.classList.add("theme-light"),document.body.classList.remove("theme-dark")),window.innerWidth<480?document.body.classList.add("is-phone"):window.innerWidth<768?document.body.classList.add("is-tablet"):window.innerWidth<1024?document.body.classList.add("is-small-screen"):document.body.classList.add("is-large-screen")</script><div class="webpage-container workspace">
			<div class="markdown-preview-view markdown-rendered allow-fold-headings  "><div class="el-h1 heading-wrapper"><div class="heading-children"><div class="el-p"><p dir="auto"><h1>Initial Access</h1><span alt="Pasted image 20241101122329.png" src="Pasted image 20241101122329.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241101122329.png" src="/Chemistry/Source/chem/pasted-image-20241101122329.png"></span><br>
The preliminary Nmap scan revealed two ports: 22 and 5000. Leaving port 22 aside, port 5000 was an web application running on Werkzeug (Python). The web app is a CIF analyzer which gave me options to login and register.<br>
<span alt="Pasted image 20241101122526.png" src="Pasted image 20241101122526.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241101122526.png" src="/Chemistry/Source/chem/pasted-image-20241101122526.png"></span></p></div><div class="el-p"><p dir="auto">According to google, <strong>Crystallographic Information File</strong> (CIF) is a standard text file format for representing crystallographic information, promulgated by the International Union of Crystallography (IUCr). So the web app is something related to Chemistry(Duh!!)/biology.<br>
<span alt="Pasted image 20241101124049.png" src="Pasted image 20241101124049.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241101124049.png" src="/Chemistry/Source/chem/pasted-image-20241101124049.png"></span></p></div><div class="el-p"><p dir="auto">So, the next step was checking for any known vulnerabilities. I checked for the normal Werkzeug vulnerabilities, but it was most probably a rabbit hole and hence didn't proceed with it from the get go. However, there was a vulnerability in the processing of the CIF files by a particular Python package (CVE-2024-23346) [<a data-tooltip-position="top" aria-label="https://www.vicarius.io/vsociety/posts/critical-security-flaw-in-pymatgen-library-cve-2024-23346" rel="noopener nofollow" class="external-link" href="https://www.vicarius.io/vsociety/posts/critical-security-flaw-in-pymatgen-library-cve-2024-23346" target="_blank">Critical Security Flaw in Pymatgen Library (CVE-2024-23346) - vsociety</a>].</p></div><div class="el-p"><p dir="auto">Since, only blind/out-of-band enumeration was possible, I went ahead and checked whether I could ping my machine from the server and it worked.<br>
<span alt="Pasted image 20241121093140.png" src="Pasted image 20241121093140.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241121093140.png" src="/Chemistry/Source/chem/pasted-image-20241121093140.png"></span><br>
<span alt="Pasted image 20241121093204.png" src="Pasted image 20241121093204.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241121093204.png" src="/Chemistry/Source/chem/pasted-image-20241121093204.png"></span></p></div><div class="el-p"><p dir="auto">So, the next step was to get a reverse shell. However, the problem was in finding the right type of reverse payload, for which I needed some help. And Voilaaa!!<br>
<span alt="Pasted image 20241121132406.png" src="Pasted image 20241121132406.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241121132406.png" src="/Chemistry/Source/chem/pasted-image-20241121132406.png"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20241121132450.png" src="Pasted image 20241121132450.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241121132450.png" src="/Chemistry/Source/chem/pasted-image-20241121132450.png"></span><br>
<span alt="Pasted image 20241121132839.png" src="Pasted image 20241121132839.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241121132839.png" src="/Chemistry/Source/chem/pasted-image-20241121132839.png"></span></p></div><div class="el-p"><p dir="auto">However, for some reason, we are getting a shell only when we upload a file from the start. If we try to View an already uploaded malicious file, its not hitting back. Weird. Moreover, there is a weird cron job running thats deleting these files, and therefore hanging the reverse session as well or not, it may be just that the box is too slow.</p></div></div></div><div class="el-h1 heading-wrapper"><h1 data-heading="Privilege Escalation" dir="auto" class="heading" id="Privilege_Escalation">Privilege Escalation</h1><div class="heading-children"><div class="el-p"><p dir="auto">So, the first thing is, we are the 'App' user and the other user in the box is Rosa, who we are supposed to gain access to, in order to get the user.txt flag. However, first, I am trying to shift to a much better access i.e. SSH.<br>
<span alt="Pasted image 20241121133620.png" src="Pasted image 20241121133620.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241121133620.png" src="/Chemistry/Source/chem/pasted-image-20241121133620.png"></span><br>
<span alt="Pasted image 20241122012730.png" src="Pasted image 20241122012730.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241122012730.png" src="/Chemistry/Source/chem/pasted-image-20241122012730.png"></span></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20241122013508.png" src="Pasted image 20241122013508.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241122013508.png" src="/Chemistry/Source/chem/pasted-image-20241122013508.png"></span></p></div><div class="el-p"><p dir="auto">So, I started checking the web source code for any hardcoded creds and got once, however, that was pretty much useless. Then, I looked into the instance folder and found the Sqlite3 Db file, which I just had to read and get the creds for Rosa user, and Voilaa!!.<br>
<span alt="Pasted image 20241122013753.png" src="Pasted image 20241122013753.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241122013753.png" src="/Chemistry/Source/chem/pasted-image-20241122013753.png"></span></p></div><div class="el-p"><p dir="auto">So, once I got the user flag. I ran Linpeas, which initially led me down another rabbit hole and I tried for some time exploiting that PV vector. However, after that, I also noticed that there was a port open at 8080, which I forwarded via SSH. IT was a site monitoring web site.<br>
<span alt="Pasted image 20241122051250.png" src="Pasted image 20241122051250.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241122051250.png" src="/Chemistry/Source/chem/pasted-image-20241122051250.png"></span></p></div><div class="el-p"><p dir="auto">This was also running over Python, but on a aiohttp instance. So naturally since this is a internal app (most prob running as root), I checked whether aiohttp/3.9.1 contained any known vulnerabilities, and it did. A Path Traversal vulnerability.(CVE-2024-23334)<a data-href="GitHub - wizarddos/CVE-2024-23334: Proof-of-Concept for LFI/Path Traversal vulnerability in Aiohttp =< 3.9.1](https://github.com/wizarddos/CVE-2024-23334)" href="GitHub - wizarddos/CVE-2024-23334: Proof-of-Concept for LFI/Path Traversal vulnerability in Aiohttp = 3.9.1](https://github.com/wizarddos/CVE-2024-23334)" class="internal-link" target="_self" rel="noopener nofollow">GitHub - wizarddos/CVE-2024-23334: Proof-of-Concept for LFI/Path Traversal vulnerability in Aiohttp =&lt; 3.9.1](https://github.com/wizarddos/CVE-2024-23334)</a></p></div><div class="el-p"><p dir="auto"><span alt="Pasted image 20241122052333.png" src="Pasted image 20241122052333.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241122052333.png" src="/Chemistry/Source/chem/pasted-image-20241122052333.png"></span><br>
<span alt="Pasted image 20241122053125.png" src="Pasted image 20241122053125.png" class="internal-embed media-embed image-embed is-loaded"><img alt="Pasted image 20241122053125.png" src="/Chemistry/Source/chem/pasted-image-20241122053125.png"></span></p></div><div class="el-p"><p dir="auto">And pawned root as well!!</p></div>

</body></html>